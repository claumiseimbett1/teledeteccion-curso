<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: Fundamentos de Teledetección</title>
    <!-- Incluir jsPDF desde CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="search"],
        input[type="tel"],
        input[type="url"],
        textarea {
            font-size: 16px;
        }


        #user-info-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 71, 171, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            box-sizing: border-box;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }

        #user-info-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #user-info-screen h2 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 1.7em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            text-align: center;
        }
        #user-info-screen h1 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 2em;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
            text-align: center;
        }
        #user-info-screen p {
            color: #e0e0e0;
            margin-bottom: 25px;
            text-align: center;
            max-width: 90%;
            font-size: 1em;
        }

        #user-info-form {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);
            width: 90%;
            max-width: 400px;
            box-sizing: border-box;
        }

        #user-info-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1em;
        }

        #user-info-form input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        #user-info-form input[type="text"]:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
            outline: none;
        }


        #start-quiz-button {
            display: block;
            width: 100%;
            padding: 14px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }

        #start-quiz-button:hover {
            background-color: #218838;
        }
        #start-quiz-button:active {
            transform: translateY(1px);
        }

        .error-message {
            color: #dc3545;
            font-size: 0.9em;
            margin-top: -15px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .quiz-container {
            width: 95%;
            max-width: 850px;
            margin: 20px auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
            box-sizing: border-box;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        #logo-container {
            width: 120px;
            max-width: 150px;
            margin: 0 auto 15px auto;
            overflow: hidden;
        }

        #logo-container img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }


        .quiz-header h1 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.8em;
        }
        .quiz-header p {
            font-size: 1em;
            color: #555;
        }


        .section-title {
            font-size: 1.4em;
            color: #0056b3;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 6px;
        }

        .question-block {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #fdfdff;
            border-left: 5px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .question-text {
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 1.05em;
        }

        .options label {
            display: block;
            margin-bottom: 8px;
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            border: 1px solid #e0e0e0;
            background-color: #fff;
        }

        .options label:hover {
            background-color: #f0f8ff;
            border-color: #b3d7ff;
        }

        .options input[type="radio"] {
            margin-right: 10px;
            vertical-align: middle;
            transform: scale(1);
        }

        .correct-answer {
            color: #155724;
            font-weight: bold;
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
        }

        .incorrect-answer {
            color: #721c24;
            font-weight: bold;
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
        }

        .user-selected.incorrect-answer {
             text-decoration: line-through;
        }

        #submit-button {
            display: block;
            width: 100%;
            padding: 14px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s, transform 0.1s;
        }

        #submit-button:hover {
            background-color: #0056b3;
        }
        #submit-button:active {
            transform: translateY(1px);
        }

        #results {
            margin-top: 30px;
            padding: 20px;
            background-color: #f0f9ff;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
            border: 1px solid #b3d7ff;
        }
        #results.hidden {
            display: none;
        }
        #results p {
            margin-bottom: 10px;
            color: #333;
        }
        #results strong {
            color: #0056b3;
        }
        #email-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.1s;
        }
        #email-link:hover {
            background-color: #218838;
        }
         #email-link:active {
            transform: translateY(1px);
        }
        .pdf-info {
            font-style: italic;
            color: #555;
            font-size: 0.9em;
            margin-top: 15px;
        }

        @media (min-width: 600px) {
            #user-info-screen h2 { font-size: 1.8em; }
            #user-info-screen h1 { font-size: 2.2em; }
            #user-info-screen p { font-size: 1.1em; max-width: 450px; }
            #user-info-form { padding: 35px; width: 100%; max-width: 420px;}
            #start-quiz-button { font-size: 1.2em; }
            .quiz-container { padding: 25px; margin: 30px auto; width: 95%;}
            #logo-container { width: 150px; margin-bottom: 20px; }
            .quiz-header h1 { font-size: 2em; }
            .quiz-header p { font-size: 1.1em; }
            .section-title { font-size: 1.6em; }
            .question-block { padding: 20px; border-left-width: 6px; }
            .question-text { font-size: 1.1em; }
            .options label { padding: 12px; }
            .options input[type="radio"] { transform: scale(1.1); }
            #submit-button { padding: 15px; font-size: 1.3em; }
            #results { padding: 25px; font-size: 1.2em; }
            #email-link { padding: 12px 25px; font-size: 1.05em; }
        }

    </style>
</head>
<body>

    <div id="user-info-screen">
        <form id="user-info-form">
            <h2>Bienvenido/a al</h2>
            <h1>Quiz: Fundamentos de Teledetección</h1>
            <p>Por favor, ingresa tu nombre y apellido para comenzar la evaluación.</p>
            <div>
                <label for="firstName">Nombre:</label>
                <input type="text" id="firstName" name="firstName" required>
            </div>
            <div>
                <label for="lastName">Apellido:</label>
                <input type="text" id="lastName" name="lastName" required>
            </div>
            <div id="name-error" class="error-message" style="display:none;">Por favor, completa ambos campos.</div>
            <button type="submit" id="start-quiz-button">Comenzar Quiz</button>
        </form>
    </div>

    <div class="quiz-container">
        <div class="quiz-header">
            <div id="logo-container">
                <img src="https://i.postimg.cc/PJ4LR0Kd/ESCUDO-UNIMAGDALENA-PNG-1024x1024.png" alt="Logo Unimagdalena">
            </div>
            <h1>Quiz: Fundamentos de Teledetección</h1>
            <p>Por Claudia Serpa</p>
        </div>
        <form id="quiz-form">
            <!-- Las preguntas se insertarán aquí por JavaScript -->
        </form>
        <button id="submit-button">Evaluar Respuestas</button>
        <div id="results" class="hidden"></div>
    </div>

    <script>
        const { jsPDF } = window.jspdf; // Acceder a jsPDF desde el objeto window

        const quizData = [
            {
                section: "Fundamentos de Teledetección",
                question: "1. ¿Qué permite la teledetección?",
                options: {
                    a: "Observar la superficie terrestre desde el espacio con contacto directo",
                    b: "Obtener información a distancia sin contacto físico directo",
                    c: "Emitir señales sonoras para detectar objetos",
                    d: "Transportar sensores en vehículos terrestres"
                },
                correctAnswer: "b"
            },
            {
                question: "2. ¿Cuál es la función principal de un sensor en teledetección?",
                options: {
                    a: "Emitir luz hacia la superficie terrestre",
                    b: "Captar radiación electromagnética reflejada, emitida o absorbida",
                    c: "Generar imágenes visibles automáticamente",
                    d: "Calcular temperatura del aire"
                },
                correctAnswer: "b"
            },
            {
                question: "3. ¿Qué es una plataforma en un sistema de teledetección?",
                options: {
                    a: "El medio donde se almacenan los datos",
                    b: "Un tipo de software de procesamiento",
                    c: "El vehículo que transporta un sensor",
                    d: "Una herramienta de corrección atmosférica"
                },
                correctAnswer: "c"
            },
            {
                question: "4. ¿Qué tipo de resolución indica la frecuencia de adquisición de datos de un mismo lugar?",
                options: {
                    a: "Espectral",
                    b: "Espacial",
                    c: "Temporal",
                    d: "Radiométrica"
                },
                correctAnswer: "c"
            },
            {
                question: "5. ¿Qué representa la resolución radiométrica en una imagen satelital?",
                options: {
                    a: "El número de bandas espectrales",
                    b: "El nivel de detalle espacial",
                    c: "La precisión con que se mide la radiación",
                    d: "El tiempo entre imágenes sucesivas"
                },
                correctAnswer: "c"
            },
            {
                question: "6. ¿Qué significa una resolución espacial de 10 m/píxel?",
                options: {
                    a: "Cada píxel representa un área de 10 metros cuadrados",
                    b: "Cada imagen ocupa 10 MB",
                    c: "El sensor opera a 10 metros de altura",
                    d: "La imagen tiene una precisión de 10 bits"
                },
                correctAnswer: "a"
            },
            {
                question: "7. ¿Qué tipo de sensor es el MSI del Sentinel-2?",
                options: {
                    a: "Sensor radar",
                    b: "Sensor óptico multiespectral",
                    c: "Sensor térmico",
                    d: "Sensor hiperespectral"
                },
                correctAnswer: "b"
            },
            {
                question: "8. ¿Qué plataforma tiene mayor resolución espacial: un satélite o un dron?",
                options: {
                    a: "El satélite",
                    b: "El dron",
                    c: "Ambos igual",
                    d: "Ninguno"
                },
                correctAnswer: "b"
            },
            {
                question: "9. ¿Cuál de los siguientes sensores es pasivo?",
                options: {
                    a: "LiDAR",
                    b: "RADAR",
                    c: "MODIS",
                    d: "SAR"
                },
                correctAnswer: "c"
            },
            {
                question: "10. ¿Qué fenómeno no está relacionado con la interacción de la radiación electromagnética con la materia?",
                options: {
                    a: "Reflexión",
                    b: "Refracción",
                    c: "Difusión",
                    d: "Convección"
                },
                correctAnswer: "d"
            },
            {
                question: "11. ¿Qué componente del espectro electromagnético es captado por sensores ópticos?",
                options: {
                    a: "Ondas de radio",
                    b: "Microondas",
                    c: "Región visible e infrarroja",
                    d: "Frecuencias sísmicas"
                },
                correctAnswer: "c"
            },
            {
                question: "12. ¿Qué tipo de resolución se relaciona con la capacidad de distinguir objetos pequeños?",
                options: {
                    a: "Temporal",
                    b: "Espectral",
                    c: "Espacial",
                    d: "Radiométrica"
                },
                correctAnswer: "c"
            },
            {
                question: "13. ¿Qué significa una resolución radiométrica de 12 bits?",
                options: {
                    a: "4096 niveles digitales posibles",
                    b: "12 bandas espectrales",
                    c: "12 píxeles por imagen",
                    d: "12 imágenes por segundo"
                },
                correctAnswer: "a"
            },
            {
                question: "14. ¿Qué unidad mide la irradiancia en teledetección?",
                options: {
                    a: "Watt por metro cuadrado (W/m²)",
                    b: "Lux",
                    c: "Candela",
                    d: "Volt"
                },
                correctAnswer: "a"
            },
            {
                question: "15. ¿Qué aplicación corresponde al uso de sensores ópticos pasivos?",
                options: {
                    a: "Mapeo de humedad del suelo en condiciones nubosas",
                    b: "Estimación de NDVI bajo luz solar",
                    c: "Topografía 3D",
                    d: "Medición de viento"
                },
                correctAnswer: "b"
            },
            {
                question: "16. ¿Qué representa el NDVI?",
                options: {
                    a: "Índice de cambio topográfico",
                    b: "Índice de vegetación basado en diferencias espectrales",
                    c: "Índice de humedad del aire",
                    d: "Índice de elevación digital"
                },
                correctAnswer: "b"
            },
            {
                question: "17. ¿Qué es una firma espectral?",
                options: {
                    a: "Un archivo digital de imágenes",
                    b: "La radiación característica reflejada por un material en diferentes longitudes de onda",
                    c: "El nombre de un sensor satelital",
                    d: "Una curva de temperatura del suelo"
                },
                correctAnswer: "b"
            },
            {
                question: "18. ¿Qué longitud de onda presenta alta reflectancia en la vegetación sana?",
                options: {
                    a: "Infrarrojo cercano (NIR)",
                    b: "Rojo",
                    c: "Azul",
                    d: "Microondas"
                },
                correctAnswer: "a"
            },
            {
                question: "19. ¿Qué ocurre con la radiación en un objeto negro ideal?",
                options: {
                    a: "Refleja toda la radiación",
                    b: "Transmite toda la radiación",
                    c: "Absorbe completamente la radiación incidente",
                    d: "Refracta toda la radiación"
                },
                correctAnswer: "c"
            },
            {
                question: "20. ¿Qué tipo de reflectancia tiene un material lambertiano?",
                options: {
                    a: "Refleja solo en una dirección",
                    b: "No refleja ninguna radiación",
                    c: "Refleja difusamente en todas direcciones",
                    d: "Refleja solo en la longitud de onda roja"
                },
                correctAnswer: "c"
            },
            {
                question: "21. ¿Qué describe la resolución espectral en un sensor?",
                options: {
                    a: "Cantidad de radiación total captada",
                    b: "Número y ancho de bandas espectrales que detecta el sensor",
                    c: "Tamaño del píxel",
                    d: "Número de imágenes por día"
                },
                correctAnswer: "b"
            },
            {
                question: "22. ¿Qué significa la sigla LIDAR?",
                options: {
                    a: "Light Detection and Ranging",
                    b: "Linear Distance Analysis Radar",
                    c: "Local Image Dynamic Array Radiometer",
                    d: "Light Intensity Distribution and Absorption Record"
                },
                correctAnswer: "a"
            },
            {
                question: "23. ¿Qué banda del espectro presenta alta absorción por clorofila en vegetación?",
                options: {
                    a: "Infrarrojo cercano",
                    b: "Verde",
                    c: "Rojo",
                    d: "Azul"
                },
                correctAnswer: "c"
            },
            {
                question: "24. ¿Qué plataforma permite mayor flexibilidad en resolución temporal y espacial?",
                options: {
                    a: "Satélites geoestacionarios",
                    b: "Aviones comerciales",
                    c: "Drones",
                    d: "Globo estratosférico"
                },
                correctAnswer: "c"
            },
            {
                question: "25. ¿Qué instrumento se utiliza para mediciones radiométricas en campo?",
                options: {
                    a: "Barómetro",
                    b: "Espectrómetro portátil",
                    c: "Microscopio óptico",
                    d: "Giroscopio"
                },
                correctAnswer: "b"
            },
            {
                question: "26. ¿Qué mide la radiancia?",
                options: {
                    a: "Energía por unidad de área y ángulo sólido",
                    b: "Temperatura del aire",
                    c: "Luz visible total",
                    d: "Frecuencia de onda sonora"
                },
                correctAnswer: "a"
            },
            {
                question: "27. ¿Qué tipo de unidad se utiliza para medir la energía radiante?",
                options: {
                    a: "Lux",
                    b: "Candela",
                    c: "Joule",
                    d: "Voltio"
                },
                correctAnswer: "c"
            },
            {
                question: "28. ¿Cuál de las siguientes magnitudes corresponde a la potencia por segundo emitida por una fuente?",
                options: {
                    a: "Radiancia",
                    b: "Potencia radiante",
                    c: "Energía radiante",
                    d: "Intensidad luminosa"
                },
                correctAnswer: "b"
            },
            {
                question: "29. ¿Qué representa la fotometría?",
                options: {
                    a: "Medición de radiación electromagnética total",
                    b: "Medición de luz visible según percepción humana",
                    c: "Medición de radiación térmica en la atmósfera",
                    d: "Medición de calor emitido por el suelo"
                },
                correctAnswer: "b"
            },
            {
                question: "30. ¿Cuál es la unidad de luminancia?",
                options: {
                    a: "W/m²",
                    b: "Candela/m²",
                    c: "Lux",
                    d: "Lumen"
                },
                correctAnswer: "b"
            },
            {
                question: "31. ¿Qué magnitud fotométrica mide el flujo luminoso sobre una superficie?",
                options: {
                    a: "Iluminancia",
                    b: "Luminancia",
                    c: "Radiancia",
                    d: "Reflexión"
                },
                correctAnswer: "a"
            },
            {
                question: "32. ¿Cuál es el pico de sensibilidad del ojo humano según la curva de luminosidad fotópica?",
                options: {
                    a: "555 nm (verde)",
                    b: "450 nm (azul)",
                    c: "650 nm (rojo)",
                    d: "700 nm (NIR)"
                },
                correctAnswer: "a"
            },
            {
                question: "33. ¿Qué factor afecta directamente la medición radiométrica desde satélites?",
                options: {
                    a: "Movimiento del suelo",
                    b: "Altitud del sensor",
                    c: "Condiciones atmosféricas",
                    d: "Temperatura del pixel"
                },
                correctAnswer: "c"
            },
            {
                question: "34. ¿Cuál es una herramienta para realizar corrección atmosférica en imágenes de Sentinel-2?",
                options: {
                    a: "Sen2Cor",
                    b: "FLIR",
                    c: "MODTRAN",
                    d: "RStudio"
                },
                correctAnswer: "a"
            },
            {
                question: "35. ¿Qué bandas espectrales permiten distinguir el contenido de agua en la vegetación?",
                options: {
                    a: "Bandas en el visible",
                    b: "Bandas del infrarrojo medio (SWIR)",
                    c: "Bandas del ultravioleta",
                    d: "Bandas de microondas"
                },
                correctAnswer: "b"
            },
            {
                question: "36. ¿Qué describe la ley de Lambert en materiales lambertianos?",
                options: {
                    a: "Reflexión especular",
                    b: "Reflexión en una sola dirección",
                    c: "Reflexión difusa igual en todas direcciones",
                    d: "No hay reflexión ni transmisión"
                },
                correctAnswer: "c"
            },
            {
                question: "37. ¿Cuál de los siguientes sensores proporciona imágenes multiespectrales gratuitas?",
                options: {
                    a: "WorldView-3",
                    b: "MODIS",
                    c: "Sentinel-2 MSI", // Sentinel-2 es una excelente opción
                    d: "Landsat 8 OLI"
                },
                correctAnswer: "c"
            },
            {
                question: "38. ¿Qué tipo de datos produce un espectrómetro portátil?",
                options: {
                    a: "Radiación microondas",
                    b: "Reflectancia espectral continua",
                    c: "Temperatura ambiental",
                    d: "Curvas de nivel topográfico"
                },
                correctAnswer: "b"
            },
            {
                question: "39. ¿Qué mide la intensidad radiante?",
                options: {
                    a: "Energía total reflejada",
                    b: "Energía por unidad de ángulo sólido", // Potencia por unidad de ángulo sólido
                    c: "Energía por metro cuadrado",
                    d: "Cantidad de luz visible"
                },
                correctAnswer: "b"
            },
            {
                question: "40. ¿Cuál es el valor típico de irradiancia solar fuera de la atmósfera?",
                options: {
                    a: "1370 W/m²",
                    b: "500 W/m²",
                    c: "1500 W/m²",
                    d: "980 W/m²"
                },
                correctAnswer: "a"
            },
            {
                question: "41. ¿Cuál es una aplicación destacada de la teledetección en agricultura?",
                options: {
                    a: "Medición de niveles de nitrógeno en laboratorio",
                    b: "Monitoreo de cultivos y estimación de biomasa",
                    c: "Captura de imágenes moleculares",
                    d: "Calibración de sensores de presión"
                },
                correctAnswer: "b"
            },
            {
                question: "42. ¿Qué fenómeno físico explica la dispersión de la luz en la atmósfera?",
                options: {
                    a: "Absorción térmica",
                    b: "Difracción",
                    c: "Dispersión de Rayleigh",
                    d: "Reflexión especular"
                },
                correctAnswer: "c"
            },
            {
                question: "43. ¿Qué propiedad óptica es fundamental en el diseño de sensores ópticos?",
                options: {
                    a: "Velocidad del sonido",
                    b: "Índice de refracción",
                    c: "Viscosidad del aire",
                    d: "Absorción sonora"
                },
                correctAnswer: "b"
            },
            {
                question: "44. ¿Qué componente de un sistema de teledetección puede incluir giroscopios y GPS?",
                options: {
                    a: "Sensor",
                    b: "Plataforma",
                    c: "Base de datos",
                    d: "Matriz espectral"
                },
                correctAnswer: "b"
            },
            {
                question: "45. ¿Qué tipo de onda permite penetrar la vegetación y obtener información estructural?",
                options: {
                    a: "Ondas visibles",
                    b: "Microondas",
                    c: "Ondas UV",
                    d: "Rayos gamma"
                },
                correctAnswer: "b"
            },
            {
                question: "46. ¿Qué significa el término 'reflectancia'?",
                options: {
                    a: "Cantidad de energía absorbida",
                    b: "Fracción de radiación incidente que es reflejada por una superficie",
                    c: "Cantidad de energía térmica emitida",
                    d: "Nivel de luz artificial aplicado"
                },
                correctAnswer: "b"
            },
            {
                question: "47. ¿Cuál es una ventaja clave del uso de sensores remotos frente a métodos tradicionales?",
                options: {
                    a: "Mayor costo y menor acceso",
                    b: "Requieren menos análisis posterior",
                    c: "Permiten monitorear áreas extensas de forma eficiente",
                    d: "Solo aplican en espacios reducidos"
                },
                correctAnswer: "c"
            },
            {
                question: "48. ¿Qué parámetro físico relaciona longitud de onda y frecuencia?",
                options: {
                    a: "Potencia",
                    b: "Radiancia",
                    c: "Velocidad de la luz",
                    d: "Índice de absorción"
                },
                correctAnswer: "c"
            },
            {
                question: "49. ¿Qué propiedad de la luz permite el uso de filtros ópticos en sensores?",
                options: {
                    a: "Refracción",
                    b: "Polarización",
                    c: "Difracción",
                    d: "Longitud de onda específica"
                },
                correctAnswer: "d"
            },
            {
                question: "50. ¿Cuál de estas tecnologías pertenece al campo de la fotónica aplicada a teledetección?",
                options: {
                    a: "Cámara infrarroja multiespectral",
                    b: "Espectrómetro de masas",
                    c: "Microscopio electrónico",
                    d: "Sensor de presión atmosférica"
                },
                correctAnswer: "a"
            }
        ];

        const userInfoScreen = document.getElementById('user-info-screen');
        const userInfoForm = document.getElementById('user-info-form');
        const firstNameInput = document.getElementById('firstName');
        const lastNameInput = document.getElementById('lastName');
        const nameErrorDiv = document.getElementById('name-error');

        const quizContainer = document.querySelector('.quiz-container');
        const quizForm = document.getElementById('quiz-form');
        const submitButton = document.getElementById('submit-button');
        const resultsDiv = document.getElementById('results');

        let currentSection = "";
        let userFirstName = "";
        let userLastName = "";
        let startTime;

        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            let timeString = "";
            if (minutes > 0) {
                timeString += `${minutes} minuto${minutes > 1 ? 's' : ''}`;
            }
            if (seconds > 0) {
                if (minutes > 0) timeString += " y ";
                timeString += `${seconds} segundo${seconds > 1 ? 's' : ''}`;
            }
            if (timeString === "") return "0 segundos";
            return timeString;
        }

        function generateAndDownloadPDF(score, totalQuestions, duration, studentFirstName, studentLastName) {
            const pdf = new jsPDF();
            const quizTitle = "Quiz: Fundamentos de Teledetección";
            const fileName = `${studentFirstName}_${studentLastName}_Resultados_Teledeteccion.pdf`;
            let yPosition = 20; // Posición Y inicial para el texto

            pdf.setFontSize(18);
            pdf.text(quizTitle, 105, yPosition, { align: 'center' });
            yPosition += 10;

            pdf.setFontSize(12);
            pdf.text(`Participante: ${studentFirstName} ${studentLastName}`, 20, yPosition);
            yPosition += 10;
            pdf.line(20, yPosition - 5, 190, yPosition - 5); // Línea divisoria

            pdf.text(`Puntuación: ${score} de ${totalQuestions}`, 20, yPosition);
            yPosition += 7;
            pdf.text(`Tiempo Empleado: ${duration}`, 20, yPosition);
            yPosition += 10;
            pdf.line(20, yPosition - 5, 190, yPosition - 5);

            // Opcional: Añadir detalle de preguntas y respuestas (puede ser largo)
            // Por ahora, solo el resumen para mantener el PDF simple.
            // Si se quisiera añadir, se iteraría sobre quizData y las respuestas del usuario.
            // Ejemplo (muy básico, requeriría más formato y manejo de páginas):
            /*
            pdf.setFontSize(10);
            quizData.forEach((item, index) => {
                if (yPosition > 270) { // Nueva página si está cerca del final
                    pdf.addPage();
                    yPosition = 20;
                }
                const userAnswer = quizForm.querySelector(`input[name="question${index}"]:checked`);
                const userAnswerValue = userAnswer ? userAnswer.value.toUpperCase() : "No respondida";
                const isCorrect = userAnswer ? (userAnswer.value.toLowerCase() === item.correctAnswer.toLowerCase()) : false;
                
                let questionText = item.question.replace(/^(\d+\.\s*)/, '').trim();
                pdf.text(`${index + 1}. ${questionText}`, 20, yPosition, { maxWidth: 170 });
                yPosition += 5;
                pdf.text(`   Tu respuesta: ${userAnswerValue} (${isCorrect ? 'Correcta' : 'Incorrecta'}) - Correcta: ${item.correctAnswer.toUpperCase()}`, 25, yPosition, { maxWidth: 165 });
                yPosition += 7;
            });
            */

            pdf.save(fileName);
        }


        function renderQuiz() {
            let html = '';
            let firstSectionProcessed = false; 

            quizData.forEach((item, index) => {
                const sectionName = item.section || "Preguntas Generales"; 

                if (sectionName !== currentSection || !firstSectionProcessed) {
                    currentSection = sectionName;
                    html += `<h2 class="section-title">${currentSection}</h2>`;
                    firstSectionProcessed = true; 
                }

                let questionText = item.question;
                const questionNumberMatch = questionText.match(/^(\d+\.\s*)/);
                if (questionNumberMatch) {
                    // No quitar el número si ya está, solo asegurar que no se duplique si lo añadimos abajo
                    questionText = questionText.replace(questionNumberMatch[0], '').trim();
                }


                html += `<div class="question-block" id="question-${index}">`;
                html += `<p class="question-text">${index + 1}. ${questionText}</p>`;
                html += `<div class="options">`;
                for (const key in item.options) {
                    html += `
                        <label for="q${index}_${key}">
                            <input type="radio" name="question${index}" id="q${index}_${key}" value="${key}">
                            ${key.toUpperCase()}. ${item.options[key]}
                        </label>
                    `;
                }
                html += `</div></div>`;
            });
            quizForm.innerHTML = html;
        }

        function evaluateQuiz() {
            const endTime = new Date();
            const durationSeconds = Math.round((endTime - startTime) / 1000);
            const formattedDuration = formatTime(durationSeconds);

            let score = 0;
            const radioButtons = quizForm.querySelectorAll('input[type="radio"]');

            radioButtons.forEach(radio => {
                radio.disabled = true;
            });

            quizData.forEach((item, index) => {
                const selectedOption = quizForm.querySelector(`input[name="question${index}"]:checked`);
                const optionLabels = quizForm.querySelectorAll(`#question-${index} .options label`);

                optionLabels.forEach(label => {
                    const radioInput = label.querySelector('input[type="radio"]');
                    if (radioInput.value.toLowerCase() === item.correctAnswer.toLowerCase()) {
                        label.classList.add('correct-answer');
                    }
                });

                if (selectedOption) {
                    const selectedLabel = selectedOption.parentElement;
                    if (selectedOption.value.toLowerCase() === item.correctAnswer.toLowerCase()) {
                        score++;
                    } else {
                        selectedLabel.classList.add('incorrect-answer');
                        selectedLabel.classList.add('user-selected');
                    }
                }
            });

            // Generar y descargar el PDF
            generateAndDownloadPDF(score, quizData.length, formattedDuration, userFirstName, userLastName);

            resultsDiv.innerHTML = `
                <p>Evaluación completada por: <strong>${userFirstName} ${userLastName}</strong></p>
                <p>Tu puntuación es: <strong>${score} de ${quizData.length}</strong></p>
                <p>Tiempo empleado: <strong>${formattedDuration}</strong></p>
                <p class="pdf-info">Se ha descargado un archivo PDF con tus resultados (${userFirstName}_${userLastName}_Resultados_Teledeteccion.pdf).</p>
            `;

            const recipientEmail = "claumiseimbett@gmail.com";
            const emailSubject = `Resultados del Quiz: Fundamentos de Teledetección - ${userFirstName} ${userLastName}`;
            const emailBody = `Nombre: ${userFirstName} ${userLastName}\n\nPuntuación: ${score}/${quizData.length}\n\nTiempo empleado: ${formattedDuration}\n\n---\nPor favor, adjunte el archivo PDF '${userFirstName}_${userLastName}_Resultados_Teledeteccion.pdf' que se ha descargado con los resultados.\nEste es un correo autogenerado.`;

            const gmailURL = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(recipientEmail)}&su=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;

            resultsDiv.innerHTML += `<a href="${gmailURL}" id="email-link" target="_blank">Enviar Resultados por Gmail</a>`;
            resultsDiv.classList.remove('hidden');
            submitButton.style.display = 'none';
        }

        userInfoForm.addEventListener('submit', function(event) {
            event.preventDefault();
            userFirstName = firstNameInput.value.trim();
            userLastName = lastNameInput.value.trim();

            if (userFirstName === "" || userLastName === "") {
                nameErrorDiv.style.display = 'block';
            } else {
                nameErrorDiv.style.display = 'none';
                userInfoScreen.classList.add('hidden');
                setTimeout(() => {
                     userInfoScreen.style.display = 'none';
                     quizContainer.style.display = 'block';
                     startTime = new Date();
                     renderQuiz();
                }, 500);
            }
        });

        submitButton.addEventListener('click', evaluateQuiz);

    </script>
</body>
</html>